<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 

<mapper namespace="orderSQL">
	<select id="orderList" parameterType="Map" resultType="orderDTO">
		select * from(select rownum rn, tt.* from 
			(select * from order_table where m_email = #{email} 
			order by 4)tt) 
			where <![CDATA[rn>=#{startNum}]]> and <![CDATA[rn<=#{endNum}]]>
	</select>
	
	<select id="totalA" resultType="Int">
		select count(*)	from order_table
	</select>
	
	<!-- 재우 -->
	<insert id="insertOrder" parameterType="Map">
		insert into order_table values(#{m_email},#{d_code},order_seq.nextval,sysdate,#{m_roadAddress}||#{m_jibunAddress},
		#{o_status},#{p_code},#{p_cost},#{p_amount}) 
	</insert>

	<select id="orderAllList" parameterType="String" resultType="orderDTO">
		select o.m_email,m.m_name,o.d_code,o.o_num,o.o_date, o_addr, o.o_status,p.p_name,o.p_cost,o.p_amount,o.p_code
		from order_table o, members m, product p where o.m_email=#{email} and o.p_code=p.p_code and o.m_email=m.m_email
   	</select>
   	
   	<select id="inquiryList" parameterType="String" resultType="inquiryDTO">
   		select * from inquiry where m_email = #{email} order by 4 desc
   	</select>
   	
	<select id="recentlyOrderList" parameterType="String" resultType="orderDTO">
		select * from(select * from order_table where m_email = #{email} order by 4 desc) where <![CDATA[rownum <=3]]>
	</select>
	
	<update id="orderCancel1" parameterType="Map">
		update product set p_amount = p_amount+#{p_amount} where p_code=#{p_code}
	</update>
	<delete id="orderCancel2" parameterType="Map">
		delete order_table where o_num=#{o_num} and m_email = #{m_email}
	</delete>
   	
</mapper>